import { formatSize } from './formatsize.js';

// è¿™æ˜¯ä¸€ä¸ªå†…éƒ¨è¾…åŠ©å‡½æ•°ï¼Œä¸éœ€è¦å¯¼å‡º
function getPreviewHtml(url) {
  const ext = (url.split('.').pop() || '').toLowerCase();
  const isImage = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg', 'icon'].includes(ext);
  const isVideo = ['mp4', 'webm'].includes(ext);
  const isAudio = ['mp3', 'wav', 'ogg'].includes(ext);

  if (isImage) {
    return `<img src="${url}" alt="é¢„è§ˆ">`;
  } else if (isVideo) {
    return `<video src="${url}" controls></video>`;
  } else if (isAudio) {
    return `<audio src="${url}" controls></audio>`;
  } else {
    return `<div style="font-size: 48px">ğŸ“„</div>`;
  }
}

// å¯¼å‡ºä¸»å‡½æ•°
export function generateFileCards(files) {
  return files.map(file => {
    const fileName = file.file_name;
    const fileSize = formatSize(file.file_size || 0);
    const createdAt = new Date(file.created_at).toISOString().replace('T', ' ').split('.')[0];
    
    return `
      <div class="file-card" data-url="${file.url}">
        <div class="file-preview">
          ${getPreviewHtml(file.url)}
        </div>
        <div class="file-info">
          <div>${fileName}</div>
          <div>${fileSize}</div>
          <div>${createdAt}</div>
        </div>
        <div class="file-actions">
          <button class="btn btn-copy" onclick="showQRCode('${file.url}')">åˆ†äº«</button>
          <a class="btn btn-down" href="${file.url}" download="${fileName}" target="_blank">ä¸‹è½½</a>
          <button class="btn btn-delete" onclick="deleteFile('${file.url}')">åˆ é™¤</button>
        </div>
      </div>
    `;
  }).join('');
}